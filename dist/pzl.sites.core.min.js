var Pzl;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(e){this.name=e}return e.prototype.ProvisionObjects=function(e,t){},e}();e.ObjectHandlerBase=t}(t=e.Model||(e.Model={}))}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Pzl;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){var n;!function(t){function n(e,t,n){var o=jQuery.Deferred(),r=_spPageContextInfo.webServerRelativeUrl+"/"+t,i=e.get_web().getFolderByServerRelativeUrl(r),a="<MetadataDefaults>";n.forEach(function(e){if(i.get_folders().add(r+"/"+e.Name),e.DefaultValues){var t=Object.keys(e.DefaultValues).length;t>0&&(a+="<a href='"+r+"/"+e.Name+"'>",Object.keys(e.DefaultValues).forEach(function(t){a+='<DefaultValue FieldName="'+t+'">'+e.DefaultValues[t]+"</DefaultValue>"}),a+="</a>")}}),a+="</MetadataDefaults>";var s=new SP.FileCreationInformation;s.set_url(r+"/Forms/client_LocationBasedDefaults.html"),s.set_content(new SP.Base64EncodedByteArray),s.set_overwrite(!0);for(var l=0;l<a.length;l++)s.get_content().append(a.charCodeAt(l));return i.get_files().add(s),o.resolve(),o.promise()}function o(t,n,o){var r=jQuery.Deferred(),i=t.get_site().get_rootWeb().get_contentTypes(),a=n.get_contentTypes();return e.Log.Information("Lists Content Types","Enabled content types for list '"+n.get_title()+"'"),n.set_contentTypesEnabled(!0),n.update(),t.load(i),t.load(a),t.executeQueryAsync(function(){o.forEach(function(t){e.Log.Information("Lists Content Types","Adding content type '"+t.ContentTypeId+"' to list '"+n.get_title()+"'"),a.addExistingContentType(i.getById(t.ContentTypeId))}),n.update(),r.resolve()},function(e,t){r.resolve(e,t)}),r.promise()}function r(t,n,o){var r=jQuery.Deferred();e.Log.Information("Lists Security","Setting security for list '"+n.get_title()+"'"),o.BreakRoleInheritance&&n.breakRoleInheritance(o.CopyRoleAssignments,o.ClearSubscopes),n.update();var i=t.get_web(),a=i.get_allProperties(),s=i.get_siteGroups(),l=i.get_roleDefinitions(),c=n.get_roleAssignments();return t.load(a),t.load(l),t.executeQueryAsync(function(){o.RoleAssignments.forEach(function(e){var n=null;n="number"==typeof e.RoleDefinition?l.getById(e.RoleDefinition):l.getByName(e.RoleDefinition);var o=SP.RoleDefinitionBindingCollection.newObject(t);o.add(n);var r=null;if(e.Principal.match(/\{[A-Za-z]*\}+/g)){var i=e.Principal.substring(1,e.Principal.length-1),u=a.get_fieldValues()["vti_"+i];r=s.getById(u)}else r=s.getByName(r);c.add(r,o)}),n.update(),t.executeQueryAsync(function(){r.resolve()},function(e,t){r.resolve(e,t)})},function(e,t){r.resolve(e,t)}),r.promise()}function i(){}t.CreateFolders=n,t.ApplyContentTypeBindings=o,t.ApplyListSecurity=r,t.CreateViews=i}(n||(n={}));var o=function(t){function o(){t.call(this,"Lists")}return __extends(o,t),o.prototype.ProvisionObjects=function(t){var o=this;e.Log.Information(this.name,"Starting provisioning of objects");var r=jQuery.Deferred(),i=SP.ClientContext.get_current(),a=i.get_web().get_lists(),s=[];return i.load(a),i.executeQueryAsync(function(){return t.forEach(function(t,n){var r=jQuery.grep(a.get_data(),function(e){return e.get_title()==t.Title})[0];if(r)e.Log.Information(o.name,"A list, survey, discussion board, or document library with the specified title '"+t.Title+"' already exists in this Web site at Url '"+t.Url+"'."),s.push(r),i.load(s[n]);else{e.Log.Information(o.name,"Creating list with Title '"+t.Title+"' and Url '"+t.Url+"'.");var l=new SP.ListCreationInformation;t.Description&&l.set_description(t.Description),t.OnQuickLaunch&&l.set_quickLaunchOption(t.OnQuickLaunch?SP.QuickLaunchOptions.on:SP.QuickLaunchOptions.off),t.TemplateType&&l.set_templateType(t.TemplateType),t.Title&&l.set_title(t.Title),t.Url&&l.set_url(t.Url),s.push(a.add(l)),i.load(s[n])}}),i.get_hasPendingRequest()?void i.executeQueryAsync(function(){var a=[];t.forEach(function(e,t){e.Folders&&e.Folders.length>0&&a.push(n.CreateFolders(i,e.Url,e.Folders)),e.ContentTypeBindings&&e.ContentTypeBindings.length>0&&a.push(n.ApplyContentTypeBindings(i,s[t],e.ContentTypeBindings)),e.Security&&a.push(n.ApplyListSecurity(i,s[t],e.Security))}),jQuery.when.apply(jQuery,a).done(function(){i.executeQueryAsync(function(){e.Log.Information(o.name,"Provisioning of objects ended"),r.resolve()})})},function(t,n){e.Log.Information(o.name,"Provisioning of objects failed"),e.Log.Error(o.name,""+n.get_message()),r.resolve(t,n)}):(e.Log.Information(o.name,"Provisioning of objects ended"),r.resolve(),r.promise())},function(t,n){e.Log.Information(o.name,"Provisioning of objects failed"),e.Log.Error(o.name,""+n.get_message()),r.resolve(t,n)}),r.promise()},o}(e.Model.ObjectHandlerBase);t.Lists=o}(t=e.ObjectHandlers||(e.ObjectHandlers={}))}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){var n;!function(e){function t(e){return e.replace("{Site}",_spPageContextInfo.webAbsoluteUrl).replace("{SiteCollection}",_spPageContextInfo.siteAbsoluteUrl).replace("{SiteCollectionRelativeUrl}",_spPageContextInfo.siteServerRelativeUrl).replace("{ThemeGallery}",_spPageContextInfo.siteServerRelativeUrl+"/_catalogs/theme/15")}e.GetUrlWithoutTokens=t}(n||(n={}));var o=function(t){function o(){t.call(this,"ComposedLook")}return __extends(o,t),o.prototype.ProvisionObjects=function(t){var o=this;e.Log.Information(this.name,"Starting provisioning of objects");var r=jQuery.Deferred(),i=SP.ClientContext.get_current(),a=i.get_web(),s=t.ColorPaletteUrl?n.GetUrlWithoutTokens(t.ColorPaletteUrl):"",l=t.FontSchemeUrl?n.GetUrlWithoutTokens(t.FontSchemeUrl):"",c=t.BackgroundImageUrl?n.GetUrlWithoutTokens(t.BackgroundImageUrl):null;return a.applyTheme(s,l,c,!0),t.MasterUrl&&a.set_masterUrl(t.MasterUrl),t.CustomMasterUrl&&a.set_customMasterUrl(t.CustomMasterUrl),a.update(),i.executeQueryAsync(function(){e.Log.Information(o.name,"Provisioning of objects ended"),r.resolve()},function(e,t){console.log(e,t),r.resolve(e,t)}),r.promise()},o}(e.Model.ObjectHandlerBase);t.ComposedLook=o}(t=e.ObjectHandlers||(e.ObjectHandlers={}))}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){var n;!function(e){function t(e){return e.replace(/{resources}/g,_spPageContextInfo.siteServerRelativeUrl+"/resources").replace(/{webpartgallery}/g,_spPageContextInfo.siteServerRelativeUrl+"/_catalogs/wp")}function n(e){return e.replace(/{site}/g,_spPageContextInfo.webServerRelativeUrl).replace(/{sitecollection}/g,_spPageContextInfo.siteServerRelativeUrl)}function o(e){var t=e.split("/");return t.splice(0,t.length-1).join("/")}function r(e){var t=e.split("/");return t[t.length-1]}function i(e){return e[e.length-1]}e.GetFileUrlWithoutTokens=t,e.GetWebPartXmlWithoutTokens=n,e.GetFolderFromFilePath=o,e.GetFilenameFromFilePath=r,e.LastItemInArray=i}(n||(n={}));var o;!function(t){function o(t,o,r){var i=jQuery.Deferred();e.Log.Information("Files","Creating file with Url '"+t+"'");var a=SP.ClientContext.get_current(),s=a.get_web(),l=n.GetFileUrlWithoutTokens(o),c=n.GetFolderFromFilePath(t),u=n.GetFilenameFromFilePath(t),f=_spPageContextInfo.webServerRelativeUrl+"/"+c,g=s.getFolderByServerRelativeUrl(f);return jQuery.get(l,function(n){var o=new SP.FileCreationInformation;o.set_overwrite(r),o.set_url(u),o.set_content(new SP.Base64EncodedByteArray);for(var s=0;s<n.length;s++)o.get_content().append(n.charCodeAt(s));a.load(g.get_files().add(o)),a.executeQueryAsync(function(){i.resolve()},function(n,o){e.Log.Information("Files","Failed to create file with Url '"+t+"'"),e.Log.Error("Files",""+o.get_message()),i.resolve(n,o)})}),i.promise()}function r(e,t,n){var o=jQuery.Deferred();if(!n)return o.resolve(),o.promise();var r=t.get_webParts();return e.load(r),e.executeQueryAsync(function(){r.get_data().forEach(function(e){e.deleteWebPart()}),e.load(r),e.executeQueryAsync(function(){o.resolve()},function(){o.resolve()})},function(){o.resolve()}),o.promise()}function i(e){var t=jQuery.Deferred(),o=[];return e.forEach(function(t,r){t.Contents.FileUrl&&o.push(function(){var o=jQuery.Deferred(),i=n.GetFileUrlWithoutTokens(t.Contents.FileUrl);return jQuery.get(i,function(t){e[r].Contents.Xml=t,o.resolve()}).fail(function(e,t){o.resolve(e,t)}),o.promise()}())}),jQuery.when.apply(jQuery,o).done(function(){t.resolve(e)}),t.promise()}function a(t,o,a,s){var l=jQuery.Deferred(),c=SP.ClientContext.get_current(),u=c.get_web(),f=n.LastItemInArray(o.split("/")),g=_spPageContextInfo.webServerRelativeUrl+"/"+t,v=u.getFileByServerRelativeUrl(g);return c.load(v),c.executeQueryAsync(function(){var o=v.getLimitedWebPartManager(SP.WebParts.PersonalizationScope.shared);r(c,o,s).then(function(){i(a).then(function(r){r.forEach(function(r){if(r.Contents.Xml){e.Log.Information("Files Web Parts","Adding web part '"+r.Title+"' to zone '"+r.Zone+"' for file with URL '"+t+"'");var i=o.importWebPart(n.GetWebPartXmlWithoutTokens(r.Contents.Xml)),a=i.get_webPart();o.addWebPart(a,r.Zone,r.Order)}}),c.executeQueryAsync(function(){e.Log.Information("Files Web Parts","Provisioning of objects ended"),l.resolve()},function(t,n){e.Log.Information("Files Web Parts","Provisioning of objects failed for file with Url '"+f+"'"),e.Log.Error("Files Web Parts",""+n.get_message()),l.resolve(t,n)})})})},function(t,n){e.Log.Information("Files Web Parts","Provisioning of objects failed for file with Url '"+f+"'"),e.Log.Error("Files Web Parts",""+n.get_message()),l.resolve(t,n)}),l.promise()}function s(t,n){var o=jQuery.Deferred(),r=SP.ClientContext.get_current(),i=r.get_web(),a=_spPageContextInfo.webServerRelativeUrl+"/"+t,s=i.getFileByServerRelativeUrl(a),l=s.get_listItemAllFields();e.Log.Information("Files Properties","Setting properties for file with URL '"+t+"'");for(var c in n)e.Log.Information("Files Properties","Setting property '"+c+"' = '"+n[c]+"' for file with URL '"+t+"'"),l.set_item(c,n[c]);return l.update(),r.executeQueryAsync(function(){e.Log.Information("Files Properties","Provisioning of objects ended"),o.resolve()},function(n,r){e.Log.Information("Files Properties","Provisioning of objects failed for file with Url '"+t+"'"),e.Log.Error("Files Properties",""+r.get_message()),o.resolve(n,r)}),o.promise()}t.AddFileByUrl=o,t.RemoveWebPartsFromFileIfSpecified=r,t.AddWebPartsToWebPartPage=a,t.ApplyFileProperties=s}(o||(o={}));var r=function(t){function n(){t.call(this,"Files")}return __extends(n,t),n.prototype.ProvisionObjects=function(t){var n=this,r=jQuery.Deferred();SP.ClientContext.get_current();e.Log.Information(this.name,"Starting provisioning of objects");var i=[];return t.forEach(function(e){o.AddFileByUrl(e.Dest,e.Src,e.Overwrite)}),jQuery.when.apply(jQuery,i).done(function(){e.Log.Information(n.name,"Provisioning of objects ended");var i=[];t.forEach(function(e){e.WebParts&&e.WebParts.length>0&&i.push(o.AddWebPartsToWebPartPage(e.Dest,e.Src,e.WebParts,e.RemoveExistingWebParts))}),jQuery.when.apply(jQuery,i).done(function(){var e=[];t.forEach(function(t){t.Properties&&Object.keys(t.Properties).length>0&&e.push(o.ApplyFileProperties(t.Dest,t.Properties))}),jQuery.when.apply(jQuery,e).done(function(){r.resolve()})})}),r.promise()},n}(e.Model.ObjectHandlerBase);t.Files=r}(t=e.ObjectHandlers||(e.ObjectHandlers={}))}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){var n;!function(e){function t(e){return e.replace(/{site}/g,_spPageContextInfo.webServerRelativeUrl).replace(/{sitecollection}/g,_spPageContextInfo.siteServerRelativeUrl)}function n(e){var t=e.split("/");return t.splice(0,t.length-1)}e.GetWebPartXmlWithoutTokens=t,e.GetFolderFromFilePath=n}(n||(n={}));var o;!function(t){function o(t){var o=jQuery.Deferred();e.Log.Information("Pages","Creating file with Url '"+t+"'");var r=SP.ClientContext.get_current(),i=r.get_web(),a=_spPageContextInfo.webServerRelativeUrl+"/"+t,s=_spPageContextInfo.webServerRelativeUrl+"/"+n.GetFolderFromFilePath(t),l=i.getFolderByServerRelativeUrl(s);return r.load(l.get_files().addTemplateFile(a,SP.TemplateFileType.wikiPage)),r.executeQueryAsync(function(){o.resolve()},function(n,r){e.Log.Information("Pages","Failed to create file with Url '"+t+"'"),e.Log.Error("Pages",""+r.get_message()),o.resolve(n,r)}),o.promise()}function r(e,t){}function i(t,o,r){var i=jQuery.Deferred(),a=SP.ClientContext.get_current(),s=a.get_web(),l=_spPageContextInfo.webServerRelativeUrl+"/"+t,c=s.getFileByServerRelativeUrl(l);return a.load(c),a.executeQueryAsync(function(){var r=c.getLimitedWebPartManager(SP.WebParts.PersonalizationScope.shared);o.forEach(function(e){var t=r.importWebPart(n.GetWebPartXmlWithoutTokens(e.Xml)),o=t.get_webPart();r.addWebPart(o,"wpz",1)}),a.executeQueryAsync(function(){e.Log.Information("Pages Web Parts","Provisioning of objects ended"),i.resolve()},function(n,o){e.Log.Information("Pages Web Parts","Provisioning of objects failed for file with Url '"+t+"'"),e.Log.Error("Pages Web Parts",""+o.get_message()),i.resolve(n,o)})},function(n,o){e.Log.Information("Pages Web Parts","Provisioning of objects failed for file with Url '"+t+"'"),e.Log.Error("Pages Web Parts",""+o.get_message()),i.resolve(n,o)}),i.promise()}t.AddWikiPageByUrl=o,t.AddLayoutToWikiPage=r,t.AddWebPartsToWikiPage=i}(o||(o={}));var r=function(t){function n(){t.call(this,"Pages")}return __extends(n,t),n.prototype.ProvisionObjects=function(t){var n=this,r=jQuery.Deferred();SP.ClientContext.get_current();e.Log.Information(this.name,"Starting provisioning of objects");var i=[];return t.forEach(function(e){o.AddWikiPageByUrl(e.Url)}),jQuery.when.apply(jQuery,i).done(function(){e.Log.Information(n.name,"Provisioning of objects ended");var i=[];t.forEach(function(e){e.WebParts&&e.WebParts.length>0&&i.push(o.AddWebPartsToWikiPage(e.Url,e.WebParts,e.RemoveExistingWebParts))}),jQuery.when.apply(jQuery,i).done(function(){r.resolve()})}),r.promise()},n}(e.Model.ObjectHandlerBase);t.Pages=r}(t=e.ObjectHandlers||(e.ObjectHandlers={}))}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){var n=function(t){function n(){t.call(this,"CustomActions")}return __extends(n,t),n.prototype.ProvisionObjects=function(t){var n=this,o=jQuery.Deferred();e.Log.Information(this.name,"Starting provisioning of objects");var r=SP.ClientContext.get_current(),i=r.get_web().get_userCustomActions();return r.load(i),r.executeQueryAsync(function(){return t.forEach(function(t){var o=jQuery.grep(i.get_data(),function(e){return e.get_title()==t.Title}).length>0;if(o)e.Log.Information(n.name,"A custom action with Title '"+t.Title+"' already exists in this Web site at Url '"+t.Url+"'.");else{e.Log.Information(n.name,"Creating custom action with Title '"+t.Title+"'");var r=i.add();t.Description&&r.set_description(t.Description),t.CommandUIExtension&&r.set_commandUIExtension(t.CommandUIExtension),t.Group&&r.set_group(t.Group),t.Title&&r.set_title(t.Title),t.Url&&r.set_url(t.Url),t.ScriptBlock&&r.set_scriptBlock(t.ScriptBlock),t.ScriptSrc&&r.set_scriptSrc(t.ScriptSrc),t.Location&&r.set_location(t.Location),t.ImageUrl&&r.set_imageUrl(t.ImageUrl),t.Name&&r.set_name(t.Name),t.RegistrationId&&r.set_registrationId(t.RegistrationId),t.RegistrationType&&r.set_registrationType(t.RegistrationType),t.Rights&&r.set_rights(t.Rights),t.Sequence&&r.set_sequence(t.Sequence),r.update()}}),r.get_hasPendingRequest()?void r.executeQueryAsync(function(){e.Log.Information(n.name,"Provisioning of objects ended"),o.resolve()},function(t,r){e.Log.Information(n.name,"Provisioning of objects failed"),e.Log.Error(n.name,""+r.get_message()),o.resolve(t,r)}):(e.Log.Information(n.name,"Provisioning of objects ended"),o.resolve(),o.promise())},function(t,r){e.Log.Information(n.name,"Provisioning of objects failed"),e.Log.Error(n.name,""+r.get_message()),o.resolve(t,r)}),o.promise()},n}(e.Model.ObjectHandlerBase);t.CustomActions=n}(t=e.ObjectHandlers||(e.ObjectHandlers={}))}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){var n;!function(e){function t(e){return e.replace("{Site}",_spPageContextInfo.webAbsoluteUrl).replace("{SiteRelativeUrl}",_spPageContextInfo.webServerRelativeUrl).replace("{SiteUrl}",_spPageContextInfo.webAbsoluteUrl).replace("{SiteUrlEncoded}",encodeURIComponent(_spPageContextInfo.webAbsoluteUrl)).replace("{SiteCollection}",_spPageContextInfo.siteAbsoluteUrl).replace("{SiteCollectionRelativeUrl}",_spPageContextInfo.siteServerRelativeUrl).replace("{SiteCollectionEncoded}",encodeURIComponent(_spPageContextInfo.siteAbsoluteUrl)).replace("{WebApp}",window.location.protocol+"//"+window.location.host)}function n(e,t){var n=jQuery.grep(e,function(e){return e.get_title()===t});return n[0]||null}e.GetUrlWithoutTokens=t,e.GetNodeFromQuickLaunchByTitle=n}(n||(n={}));var o=function(t){function o(){t.call(this,"LocalNavigation")}return __extends(o,t),o.prototype.ProvisionObjects=function(t){var o=this,r=jQuery.Deferred(),i=SP.ClientContext.get_current(),a=i.get_web();e.Log.Information(this.name,"Starting provisioning of objects");var s=a.get_navigation(),l=s.get_quickLaunch();return i.load(l),i.executeQueryAsync(function(){e.Log.Information(o.name,"Removing existing navigation nodes");for(var a=[],s=l.get_count()-1;s>=0;){var c=l.itemAt(s);a.push(c),c.deleteObject(),s--}i.executeQueryAsync(function(){t.forEach(function(t){e.Log.Information(o.name,"Adding navigation node with Url '"+t.Url+"' and Title '"+t.Title+"'");var r=n.GetNodeFromQuickLaunchByTitle(a,t.Title),i=new SP.NavigationNodeCreationInformation;i.set_title(t.Title),i.set_url(r?r.get_url():n.GetUrlWithoutTokens(t.Url)),i.set_asLastNode(!0),l.add(i)}),i.executeQueryAsync(function(){e.Log.Information(o.name,"Provisioning of objects ended"),r.resolve()},function(t,n){e.Log.Information(o.name,"Provisioning of objects failed"),e.Log.Error(o.name,""+n.get_message()),r.resolve(t,n)})})},function(t,n){e.Log.Information(o.name,"Provisioning of objects failed"),e.Log.Error(o.name,""+n.get_message()),r.resolve(t,n)}),r.promise()},o}(e.Model.ObjectHandlerBase);t.LocalNavigation=o}(t=e.ObjectHandlers||(e.ObjectHandlers={}))}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){var n=function(t){function n(){t.call(this,"PropertyBagEntries")}return __extends(n,t),n.prototype.ProvisionObjects=function(t){var n=this;e.Log.Information(this.name,"Starting provisioning of objects");var o=jQuery.Deferred(),r=SP.ClientContext.get_current(),i=r.get_web(),a=i.get_allProperties();for(var s in t)e.Log.Information(this.name,"Setting property '"+s+"' = '"+t[s]+"' on web"),a.set_item(s,t[s]);return i.update(),r.executeQueryAsync(function(){e.Log.Information(n.name,"Provisioning of objects ended"),o.resolve()},function(e,t){o.resolve(e,t)}),o.promise()},n}(e.Model.ObjectHandlerBase);t.PropertyBagEntries=n}(t=e.ObjectHandlers||(e.ObjectHandlers={}))}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(e){this.array=[],this.loggingOptions=e}return e.prototype.loggerEnabled=function(){return console&&console.log},e.prototype.Information=function(e,t){if(this.loggingOptions){var n=new Date+" || Information || "+e+" || "+t;this.loggerEnabled&&this.loggingOptions.On&&console.log(n),this.array.push(n)}},e.prototype.Error=function(e,t){if(this.loggingOptions){var n=new Date+" || Error || "+e+" || "+t;this.loggerEnabled&&this.loggingOptions.On&&console.log(n),this.array.push(n)}},e.prototype.SaveToFile=function(){var e=jQuery.Deferred();if(!this.loggingOptions||!this.loggingOptions.LoggingFolder)return e.resolve(),e.promise();var t=SP.ClientContext.get_current(),n=t.get_site().get_rootWeb(),o=(new Date).getTime()+".txt",r=new SP.FileCreationInformation;r.set_url(o),r.set_content(new SP.Base64EncodedByteArray);for(var i=this.array.join("\n"),a=0;a<i.length;a++)r.get_content().append(i.charCodeAt(a));return t.load(n.getFolderByServerRelativeUrl(this.loggingOptions.LoggingFolder).get_files().add(r)),t.executeQueryAsync(function(){e.resolve()},function(t,n){e.resolve(t,n)}),e.promise()},e}();e.Logger=t}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(e,t,n,o,r){this.name=e,this.index=t,this.objects=n,this.parameters=o,this.callback=r}return e.prototype.execute=function(e){var t=this;if(!e)return this.callback(this.objects,this.parameters);var n=jQuery.Deferred();return e.done(function(){return t.callback(t.objects,t.parameters).done(function(){n.resolve()})}),n.promise()},e}();e.TemplateQueueItem=t}(t=e.Model||(e.Model={}))}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));var Pzl;!function(e){var t;!function(e){var t;!function(e){function t(e,t,n,o){i=SP.UI.ModalDialog.showWaitScreenWithNoClose(e,t,n,o)}function n(e){return Object.keys(e)}function o(t,n){var o=jQuery.Deferred();a=(new Date).getTime(),e.Log.Information("Provisioning","Starting at URL '"+_spPageContextInfo.webServerRelativeUrl+"'");var r=[];n.forEach(function(n,o){e.ObjectHandlers[n]&&r.push(new e.Model.TemplateQueueItem(n,o,t[n],t.Parameters,(new e.ObjectHandlers[n]).ProvisionObjects))});var i=[];i.push(jQuery.Deferred()),i[0].resolve(),i[0].promise();for(var s=1;void 0!=r[s-1];){var l=i.length-1;i.push(r[s-1].execute(i[l])),s++}return jQuery.when.apply(jQuery,i).done(function(){o.resolve()}),o.promise()}function r(r,s){var l=jQuery.Deferred();t("Applying template","This might take a moment..",130,600),e.Log=new e.Logger(s);var c=n(r);return o(r,c).then(function(){var t=((new Date).getTime()-a)/1e3;e.Log.Information("Provisioning","All done in "+t+" seconds"),e.Log.SaveToFile().then(function(){i.close(null),l.resolve()})}),l.promise()}var i,a=null;e.init=r}(t=e.Core||(e.Core={}))}(t=e.Sites||(e.Sites={}))}(Pzl||(Pzl={}));